//-/////////////////////////////////////////////////////////////////////////////
//-                                                                           //
//-               This file is part of the Buildbotics firmware.              //
//-                                                                           //
//-      Copyright (c) 2015 - 2023, Buildbotics LLC, All rights reserved.     //
//-                                                                           //
//-       This Source describes Open Hardware and is licensed under the       //
//-                               CERN-OHL-S v2.                              //
//-                                                                           //
//-       You may redistribute and modify this Source and make products       //
//-  using it under the terms of the CERN-OHL-S v2 (https:/cern.ch/cern-ohl). //
//-         This Source is distributed WITHOUT ANY EXPRESS OR IMPLIED         //
//-  WARRANTY, INCLUDING OF MERCHANTABILITY, SATISFACTORY QUALITY AND FITNESS //
//-   FOR A PARTICULAR PURPOSE. Please see the CERN-OHL-S v2 for applicable   //
//-                                conditions.                                //
//-                                                                           //
//-              Source location: https://github.com/buildbotics              //
//-                                                                           //
//-    As per CERN-OHL-S v2 section 4, should You produce hardware based on   //
//-  these sources, You must maintain the Source Location clearly visible on  //
//-  the external case of the CNC Controller or other product you make using  //
//-                                this Source.                               //
//-                                                                           //
//-              For more information, email info@buildbotics.com             //
//-                                                                           //
//-/////////////////////////////////////////////////////////////////////////////

script#view-debug-template(type="text/x-template")
  #debug
    .toolbar.pure-form
      bbutton(title="Select a G-code file to debug.", @click="open",
        :disabled="debugging", text="Open")

      bbutton(title="Start debugging session.", @click="startDebug",
        :disabled="!canDebug", text="Start Debug", icon="bug")

      bbutton(title="Stop debugging session.", @click="stopDebug",
        :disabled="!debugging", text="Stop Debug", icon="stop")

      .separator

      bbutton(title="Execute current line and move to next executable line.",
        @click="step", :disabled="!canStep", text="Step", icon="step-forward")

      bbutton(title="Skip current line without executing.",
        @click="skip", :disabled="!canSkip", text="Skip", icon="forward")

      bbutton(title="Skip to specific line number.",
        @click="showSkipToPrompt", :disabled="!canSkip", text="Skip To",
        icon="fast-forward")

      bbutton(title="Continue normal execution from current position.",
        @click="continue", :disabled="!canContinue", text="Continue",
        icon="play")

      .separator

      bbutton(title="Edit this file.", @click="edit", text="Edit", 
        :disabled="!path || debugging")

      bbutton(title="View this file in 3D.", @click="view", text="View",
        :disabled="!path || debugging", v-if="$root.webGLSupported")

      .filename {{filename}}

    .debug-info(v-if="debugging")
      .current-line-info
        | Current Line: {{currentLineNumber}}
        span(v-if="currentLineNumber > 0") 
          | &nbsp;-&nbsp;
          span.line-content {{editor ? editor.getLine(currentLine) : ''}}

      .debug-status
        span.debug-mode-indicator &#x1f41b; Debug Mode Active
        
    .editor-container
      textarea(v-el:textarea, placeholder="Select a G-code file to debug...")

    // Skip To Dialog
    dialog(v-show="showSkipToDialog", @close="showSkipToDialog = false")
      div(slot="header") Skip To Line
      div(slot="body")
        .pure-form
          label(for="skipToInput") Line Number:
          input#skipToInput(type="number", v-model="skipToLineNumber", 
            min="1", placeholder="Enter line number", @keyup.enter="skipTo")
          
      div(slot="footer")
        bbutton(@click="showSkipToDialog = false", text="Cancel")
        bbutton.button-success(@click="skipTo", text="Skip To",
          :disabled="!skipToLineNumber")

  style.
    #debug {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #debug .toolbar {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      flex-shrink: 0;
    }

    #debug .toolbar .separator {
      width: 1px;
      height: 24px;
      background: #ddd;
      margin: 0 10px;
    }

    #debug .filename {
      margin-left: auto;
      font-weight: bold;
      color: #333;
    }

    #debug .debug-info {
      background: #f0f8ff;
      border-bottom: 1px solid #ddd;
      padding: 8px 10px;
      flex-shrink: 0;
    }

    #debug .current-line-info {
      font-family: monospace;
      font-size: 12px;
      margin-bottom: 4px;
    }

    #debug .line-content {
      color: #666;
      font-style: italic;
    }

    #debug .debug-status {
      font-size: 12px;
    }

    #debug .debug-mode-indicator {
      color: #ff6600;
      font-weight: bold;
    }

    #debug .editor-container {
      flex: 1;
      min-height: 0;
    }

    #debug textarea {
      width: 100%;
      height: 100%;
      border: none;
      font-family: monospace;
      font-size: 12px;
      resize: none;
    }

    /* CodeMirror debug styling */
    .CodeMirror {
      height: 100%;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .debug-current-line {
      background: rgba(255, 255, 0, 0.3) !important;
    }

    .debug-breakpoints {
      width: 16px;
    }

    .debug-breakpoint-marker {
      color: #d73027;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      line-height: 1;
      font-size: 14px;
    }

    .debug-breakpoint-marker:hover {
      color: #a50f15;
    }

    .debug-current-line-gutter {
      width: 16px;
    }

    /* Skip To Dialog Styling */
    #skipToInput {
      width: 100px;
      margin-left: 10px;
    }